{% schema %}
{
  "name": "2 Column Multi-Images",
  "tag": "section",
  "class": "multi-img-column",
  "settings": [
    {
      "type": "text",
      "id": "custom_anchor_id",
      "label": "Custom Section ID (for Smooth Scroll)",
      "default": "multi-images-content"
    },
    {
      "type": "checkbox",
      "id": "show_top_border",
      "label": "Show Top Border",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_bottom_border",
      "label": "Show Bottom Border",
      "default": true
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#FDFCF9",
      "info": "Leave as-is to mimic --custom-light."
    },

    /* Multiple banner images (side) */
    {
      "type": "image_picker",
      "id": "section_image_1",
      "label": "Image 1"
    },
    {
      "type": "image_picker",
      "id": "section_image_2",
      "label": "Image 2"
    },
    {
      "type": "image_picker",
      "id": "section_image_3",
      "label": "Image 3"
    },
    {
      "type": "image_picker",
      "id": "section_image_4",
      "label": "Image 4"
    },
    {
      "type": "range",
      "id": "fade_duration",
      "label": "Fade Duration (seconds)",
      "min": 2,
      "max": 8,
      "step": 1,
      "default": 4
    },
    {
      "type": "select",
      "id": "image_position",
      "label": "Image Position",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "image_fit",
      "label": "Banner Image Fit",
      "options": [
        { "value": "cover", "label": "Cover (fill & crop)" },
        { "value": "contain", "label": "Contain (no crop)" }
      ],
      "default": "cover"
    },
    {
      "type": "range",
      "id": "image_border_radius",
      "label": "Image Border Radius (px)",
      "min": 0,
      "max": 50,
      "step": 1,
      "default": 0
    },
    {
      "type": "number",
      "id": "image_min_height",
      "label": "Image Min Height (px)",
      "default": 650
    },
    {
      "type": "number",
      "id": "image_max_height",
      "label": "Image Max Height (px)",
      "default": 650
    },

    /* Content */
    {
      "type": "text",
      "id": "overline",
      "label": "Sub text (above heading)",
      "default": "Premium Comfort"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading (use <span> for accent)",
      "default": "Why does every layer <span>feel like Love?</span>"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description"
    },

    /* Secondary image (below description) */
    {
      "type": "image_picker",
      "id": "content_image",
      "label": "Content Image (below description)",
      "info": "Optional image that appears below the description."
    },
    {
      "type": "text",
      "id": "content_image_alt",
      "label": "Content Image Alt Text",
      "default": "Alt text"
    },
    {
      "type": "range",
      "id": "content_image_max_width",
      "label": "Content Image Max Width (px)",
      "min": 100,
      "max": 1100,
      "step": 10,
      "default": 800
    },

    /* Button */
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label",
      "default": "See What's Inside"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button Link"
    },

    /* Spacing */
    {
      "type": "number",
      "id": "padding_top",
      "label": "Padding Top (px)",
      "default": 60
    },
    {
      "type": "number",
      "id": "padding_bottom",
      "label": "Padding Bottom (px)",
      "default": 60
    }
  ],
  "presets": [
    {
      "name": "2 Column Multi-Images",
      "category": "Custom"
    }
  ]
}
{% endschema %}

{% assign top_border_style = '' %}
{% if section.settings.show_top_border %}
  {% assign top_border_style = 'border-top: 1px solid var(--custom-dark)' %}
{% endif %}

{% assign bottom_border_style = '' %}
{% if section.settings.show_bottom_border %}
  {% assign bottom_border_style = 'border-bottom: 1px solid var(--custom-dark)' %}
{% endif %}

<!-- Collect all images that exist -->
{% assign section_images = '' | split: ',' %}
{% if section.settings.section_image_1 != blank %}
  {% assign section_images = section_images | append: section.settings.section_image_1.id | split: ',' %}
{% endif %}
{% if section.settings.section_image_2 != blank %}
  {% assign section_images = section_images | append: ',' | append: section.settings.section_image_2.id | split: ',' %}
{% endif %}
{% if section.settings.section_image_3 != blank %}
  {% assign section_images = section_images | append: ',' | append: section.settings.section_image_3.id | split: ',' %}
{% endif %}
{% if section.settings.section_image_4 != blank %}
  {% assign section_images = section_images | append: ',' | append: section.settings.section_image_4.id | split: ',' %}
{% endif %}

<div
  {% if section.settings.custom_anchor_id %}
    id="{{ section.settings.custom_anchor_id | escape }}"
  {% endif %}
  class="multi-img-column{% if section.settings.image_position == 'right' %} multi-img-column--reverse{% endif %}"
  style="
    {{ top_border_style }}; {{ bottom_border_style }};
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    background-color: {{ section.settings.background_color }};
    --split-img-fit: {{ section.settings.image_fit }};
    --split-content-img-max-width: {{ section.settings.content_image_max_width | default: 800 }}px;
    --fade-duration: {{ section.settings.fade_duration }}s;
    --split-border-radius: {{ section.settings.image_border_radius | default: 0 }}px;
    --image-min-height: {{ section.settings.image_min_height | default: 650 }}px;
    --image-max-height: {{ section.settings.image_max_height | default: 650 }}px;
  "
>
  <div class="multi-img__image-col">
    {% if section_images.size > 0 %}
      <div class="multi-img__image-slider">
        {% if section.settings.section_image_1 != blank %}
          <img
            src="{{ section.settings.section_image_1 | image_url: width: 1600 }}"
            alt="{{ section.settings.heading | strip_html }}"
            width="1600"
            height="auto"
            loading="lazy"
            class="multi-img__img multi-img__img--active"
          >
        {% endif %}
        {% if section.settings.section_image_2 != blank %}
          <img
            src="{{ section.settings.section_image_2 | image_url: width: 1600 }}"
            alt="{{ section.settings.heading | strip_html }}"
            width="1600"
            height="auto"
            loading="lazy"
            class="multi-img__img"
          >
        {% endif %}
        {% if section.settings.section_image_3 != blank %}
          <img
            src="{{ section.settings.section_image_3 | image_url: width: 1600 }}"
            alt="{{ section.settings.heading | strip_html }}"
            width="1600"
            height="auto"
            loading="lazy"
            class="multi-img__img"
          >
        {% endif %}
        {% if section.settings.section_image_4 != blank %}
          <img
            src="{{ section.settings.section_image_4 | image_url: width: 1600 }}"
            alt="{{ section.settings.heading | strip_html }}"
            width="1600"
            height="auto"
            loading="lazy"
            class="multi-img__img"
          >
        {% endif %}
      </div>
    {% endif %}
  </div>

  <div class="multi-img__text-col">
    <div class="multi-img__text-inner">
      {% if section.settings.overline != blank %}
        <div class="multi-img__overline">{{ section.settings.overline }}</div>
      {% endif %}

      <h2 class="h1 multi-img__heading font-cursive">
        {{ section.settings.heading }}
      </h2>

      {% if section.settings.description != blank %}
        <div class="multi-img__desc">{{ section.settings.description }}</div>
      {% endif %}

      {% if section.settings.content_image != blank %}
        <div class="multi-img__content-image-wrap">
          <img
            src="{{ section.settings.content_image | image_url: width: 1400 }}"
            alt="{{ section.settings.content_image_alt | default: section.settings.heading | strip_html }}"
            width="1400"
            height="auto"
            loading="lazy"
            class="multi-img__content-image"
          >
        </div>
      {% endif %}

      {% if section.settings.button_label != blank and section.settings.button_url != blank %}
        <a href="{{ section.settings.button_url }}" class="multi-img__btn">
          {{ section.settings.button_label }}
          <span class="multi-img__btn-arrow">â€º</span>
        </a>
      {% endif %}
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const imageSliders = document.querySelectorAll('.multi-img__image-slider');
  
  imageSliders.forEach(slider => {
    const images = slider.querySelectorAll('.multi-img__img');
    if (images.length <= 1) return;
    
    const section = slider.closest('.multi-img-column');
    const fadeDuration = parseFloat(getComputedStyle(section).getPropertyValue('--fade-duration')) || 4;
    
    let currentIndex = 0;
    
    function fadeToNext() {
      const currentImg = images[currentIndex];
      const nextIndex = (currentIndex + 1) % images.length;
      const nextImg = images[nextIndex];
      
      // Start fade out current image
      currentImg.classList.remove('multi-img__img--active');
      
      // After fade duration, show next image
      setTimeout(() => {
        nextImg.classList.add('multi-img__img--active');
        currentIndex = nextIndex;
      }, 500); // Half second for smooth transition
    }
    
    // Start the slideshow
    setInterval(fadeToNext, fadeDuration * 1000);
  });
});
</script>

<style>
/* Base */
.multi-img-column {
  width: 100vw;
  display: flex;
  flex-direction: row;
  justify-content: stretch;
  align-items: stretch;
  transition: padding 0.2s, background-color 0.2s;
  font-family: inherit; /* Dawn default */
}
.multi-img-column--reverse { flex-direction: row-reverse; }

.multi-img__image-col {
  flex: 1 1 50%;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  min-height: var(--image-min-height);
  max-height: var(--image-max-height);
  overflow: hidden;
}

/* Image slider container */
.multi-img__image-slider {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Banner (side) images: responsive with fade effect and dynamic border radius */
.multi-img__img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: var(--split-img-fit);
  object-position: left center;
  display: block;
  opacity: 0;
  transition: opacity 1s ease-in-out;
  z-index: 1;
  /* Default: left position gets top-right & bottom-right radius */
  border-radius: 0 var(--split-border-radius) var(--split-border-radius) 0;
}

.multi-img__img--active {
  opacity: 1;
  z-index: 2;
}

/* When image is on right: top-left & bottom-left radius */
.multi-img-column--reverse .multi-img__img { 
  object-position: right center;
  border-radius: var(--split-border-radius) 0 0 var(--split-border-radius);
}

.multi-img__text-col {
  flex: 1 1 50%;
  display: flex;
  align-items: center;
  justify-content: flex-start;
}
.multi-img__text-inner {
  width: 100%;
  max-width: 800px;
  margin: 0 0 0 7vw;
  padding: 4vw 3vw 4vw 0;
  box-sizing: border-box;
}
.multi-img-column--reverse .multi-img__text-inner {
  margin: 0 7vw 0 0;
  padding: 4vw 0 4vw 3vw;
}

/* Overline / sub text */
.multi-img__overline {
  color: var(--custom-dark);
  letter-spacing: 0.06em;
  text-transform: none;
  font-size: 0.9em; /* 90% */
  line-height: 1.2;
  margin-bottom: 0.6rem;
}

/* Heading */
.multi-img__heading {
  color: var(--custom-dark);
  margin-bottom: 1.1rem;
  margin-top: 1.1rem;
  line-height: 1.13;
  font-weight: 400; /* normal */
}
{% comment %} .multi-img__heading span { color: var(--custom-secondary); } {% endcomment %}

/* Description */
.multi-img__desc {
  color: var(--custom-dark);
  opacity: 0.93;
  margin-bottom: 1.4rem;
  line-height: 1.6;
}

/* Secondary content image â€” left-aligned, 100% width with adjustable max-width */
.multi-img__content-image-wrap { margin: 1.6rem 0 2.1rem; }
.multi-img__content-image {
  display: block;
  width: 100%;
  max-width: var(--split-content-img-max-width);
  height: auto;
  object-fit: contain;
  border-radius: 0;
  margin-left: 0;
  margin-right: 0;
}

/* Button: sharp corners */
.multi-img__btn {
  display: inline-flex;
  align-items: center;
  background: transparent;
  color: var(--custom-dark);
  font-weight: 500;
  padding: 1.1rem 2.3rem;
  border: 1px solid var(--custom-dark);
  min-width: 260px;
  text-decoration: none;
  cursor: pointer;
  border-radius: 0;
}
.multi-img__btn-arrow { margin-left: 0.8em; font-size: 1.3em; }
.multi-img__btn:hover {
  background: var(--custom-primary);
  color: var(--custom-dark);
  border-color: var(--custom-primary);
}

/* Breakpoints: 990 / 749 / 479 */
@media (max-width: 990px) {
  .multi-img-column { flex-direction: column !important; }
  .multi-img__image-col,
  .multi-img__text-col { flex: 0 0 100%; min-height: 350px; }
  .multi-img__img { 
    object-position: center;
    /* Reset border radius on mobile */
    border-radius: 0 !important;
  }
  .multi-img__text-inner {
    margin: 0;
    padding: 6vw 6vw;
    text-align: center;
    max-width: 880px;
  }
}
@media (max-width: 749px) {
  .multi-img__text-inner { padding: 7vw 5rem; }
  .multi-img__btn { min-width: 180px; padding: 1rem 1.6rem; }
}
@media (max-width: 479px) {
  .multi-img__text-inner { padding: 7vw 3rem; }
  .multi-img__btn { min-width: 140px; padding: 0.7rem 1.2rem; }
}
</style>