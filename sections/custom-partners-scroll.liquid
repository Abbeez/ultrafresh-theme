{% schema %}
{
  "name": "Partners Autoscroll",
  "settings": [
    {
      "type": "number",
      "id": "padding_top",
      "label": "Section Padding Top (px)",
      "default": 80
    },
    {
      "type": "number",
      "id": "padding_bottom",
      "label": "Section Padding Bottom (px)",
      "default": 80
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#F5F0EA"
    },
    {
      "type": "text",
      "id": "main_text",
      "label": "Main Text (before partner name)",
      "default": "Find us at"
    },
    {
      "type": "range",
      "id": "animation_speed",
      "label": "Animation Speed (seconds)",
      "min": 2,
      "max": 8,
      "step": 1,
      "default": 4,
      "info": "How long each partner name is displayed"
    }
  ],
  "presets": [
    {
      "name": "Partners Autoscroll"
    }
  ]
}
{% endschema %}

{% comment %}
Use the working metaobject code provided by user
{% endcomment %}
{% assign partners_list = shop.metaobjects.partners.values | default: empty %}
{% assign partners_url = shop.metaobjects.partners.values %}

<div 
  class="partners-autoscroll"
  style="
    padding-top: {{ section.settings.padding_top | default: 80 }}px;
    padding-bottom: {{ section.settings.padding_bottom | default: 80 }}px;
    background-color: {{ section.settings.background_color }};
  "
>
  <!-- Decorative elements -->
  <div class="partners-autoscroll__decorations">
    <div class="partners-autoscroll__deco partners-autoscroll__deco--1">
      <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
        <circle cx="20" cy="20" r="18" stroke="#8B9DC3" stroke-width="2" fill="none"/>
        <circle cx="20" cy="15" r="3" fill="#8B9DC3"/>
        <path d="M15 25c0-3 2-5 5-5s5 2 5 5" stroke="#8B9DC3" stroke-width="2" fill="none"/>
      </svg>
    </div>
    <div class="partners-autoscroll__deco partners-autoscroll__deco--2">
      <svg width="30" height="30" viewBox="0 0 30 30" fill="none">
        <path d="M15 5l3 9h9l-7.5 5.5 3 9L15 23l-7.5 5.5 3-9L3 14h9z" fill="#D4A574"/>
      </svg>
    </div>
    <div class="partners-autoscroll__deco partners-autoscroll__deco--3">
      <svg width="35" height="35" viewBox="0 0 35 35" fill="none">
        <path d="M5 15c0 0 5-10 15-5s10 15 5 20-15-5-20-15z" fill="#A8B8D8"/>
      </svg>
    </div>
    <div class="partners-autoscroll__deco partners-autoscroll__deco--4">
      <svg width="25" height="35" viewBox="0 0 25 35" fill="none">
        <path d="M5 5c0 0 15-2 15 10s-10 15-15 10-5-15 0-20z" fill="#E8D5B7"/>
      </svg>
    </div>
    <div class="partners-autoscroll__deco partners-autoscroll__deco--5">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
        <circle cx="10" cy="10" r="8" fill="#8B9DC3"/>
      </svg>
    </div>
    <div class="partners-autoscroll__deco partners-autoscroll__deco--6">
      <svg width="28" height="28" viewBox="0 0 28 28" fill="none">
        <rect x="4" y="4" width="20" height="20" rx="3" fill="#D4A574"/>
      </svg>
    </div>
  </div>

  <div class="partners-autoscroll__content page-width">
    <div class="partners-autoscroll__text">
      <span class="partners-autoscroll__main-text">{{ section.settings.main_text }}</span>
      <div class="partners-autoscroll__partner-container">
        {% if partners_list.count > 0 %}
          {% assign partner_index = 0 %}
          {% for partner in partners_list %}
            {% unless metaobject.system.handle == partner.system.handle %}
              <span class="partners-autoscroll__partner-name{% if partner_index == 0 %} partners-autoscroll__partner-name--active{% endif %}" 
                    data-partner-index="{{ partner_index }}">
                {{ partner.name }}
              </span>
              {% assign partner_index = partner_index | plus: 1 %}
            {% endunless %}
          {% endfor %}
        {% else %}
          <!-- Fallback partners for testing -->
          <span class="partners-autoscroll__partner-name partners-autoscroll__partner-name--active" 
                data-partner-index="0">
            Walmart
          </span>
          <span class="partners-autoscroll__partner-name" 
                data-partner-index="1">
            Target  
          </span>
          <span class="partners-autoscroll__partner-name" 
                data-partner-index="2">
            Amazon
          </span>
        {% endif %}
      </div>
    </div>
    {% if section.settings.subtitle != blank %}
      <div class="partners-autoscroll__subtitle">{{ section.settings.subtitle }}</div>
    {% endif %}
  </div>
</div>

<style>
.partners-autoscroll {
  position: relative;
  width: 100vw;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 200px;
}

.partners-autoscroll__decorations {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
}

.partners-autoscroll__deco {
  position: absolute;
  opacity: 0.6;
}

.partners-autoscroll__deco--1 {
  top: 20%;
  left: 8%;
  animation: float 6s ease-in-out infinite;
}

.partners-autoscroll__deco--2 {
  top: 15%;
  left: 15%;
  animation: float 4s ease-in-out infinite 0.5s;
}

.partners-autoscroll__deco--3 {
  top: 25%;
  right: 10%;
  animation: float 5s ease-in-out infinite 1s;
}

.partners-autoscroll__deco--4 {
  top: 10%;
  right: 20%;
  animation: float 4.5s ease-in-out infinite 1.5s;
}

.partners-autoscroll__deco--5 {
  bottom: 20%;
  left: 12%;
  animation: float 3.5s ease-in-out infinite 2s;
}

.partners-autoscroll__deco--6 {
  bottom: 15%;
  right: 15%;
  animation: float 5.5s ease-in-out infinite 0.8s;
}

@keyframes float {
  0%, 100% {
    transform: translateY(0px) rotate(0deg);
  }
  50% {
    transform: translateY(-15px) rotate(5deg);
  }
}

.partners-autoscroll__content {
  text-align: center;
  z-index: 2;
  position: relative;
}

.partners-autoscroll__text {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.partners-autoscroll__inline-text {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 1rem;
}

.partners-autoscroll__main-text {
  font-size: 1.2em;
  color: var(--custom-dark, #384148);
  font-weight: 400;
  line-height: 1.3;
}

.partners-autoscroll__partner-container {
  position: relative;
  height: 1.5em;
  min-width: 200px;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  overflow: hidden;
}

.partners-autoscroll__partner-name {
  position: absolute;
  left: 0;
  top: 0;
  font-size: 1.2em;
  font-weight: 700;
  line-height: 1.5;
  transform: translateY(100%);
  opacity: 0;
  transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  white-space: nowrap;
  background: linear-gradient(90deg, #5db431, #139cdd);
 -webkit-text-fill-color: transparent;
 background-clip: text;
color: transparent;
}

.partners-autoscroll__partner-name--active {
  transform: translateY(0%);
  opacity: 1;
}

.partners-autoscroll__subtitle {
  font-size: 1em;
  color: var(--custom-dark, #384148);
  opacity: 0.8;
  font-weight: 400;
}

/* Responsive */
@media (max-width: 990px) {
  .partners-autoscroll {
    min-height: 150px;
  }
  
  .partners-autoscroll__main-text {
    font-size: 1.1em;
  }
  
  .partners-autoscroll__partner-name {
    font-size: 1.1em;
  }
  
  .partners-autoscroll__partner-container {
    width: 130px;
    height: 1.4em;
  }
  
  .partners-autoscroll__inline-text {
    gap: 0.4rem;
  }
}

@media (max-width: 749px) {
  .partners-autoscroll {
    min-height: 120px;
  }
  
  .partners-autoscroll__main-text {
    font-size: 1em;
  }
  
  .partners-autoscroll__partner-name {
    font-size: 1em;
  }
  
  .partners-autoscroll__partner-container {
    width: 110px;
    height: 1.3em;
  }
  
  .partners-autoscroll__inline-text {
    flex-direction: column;
    gap: 0.3rem;
    align-items: center;
  }
  
  .partners-autoscroll__deco {
    opacity: 0.4;
    transform: scale(0.8);
  }
}

@media (max-width: 479px) {
  .partners-autoscroll {
    min-height: 100px;
  }
  
  .partners-autoscroll__partner-name {
    font-size: 0.9em;
  }
  
  .partners-autoscroll__partner-container {
    width: 100px;
    height: 1.2em;
  }
  
  .partners-autoscroll__deco {
    opacity: 0.3;
    transform: scale(0.6);
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const partnerNames = document.querySelectorAll('.partners-autoscroll__partner-name');
  
  if (partnerNames.length <= 1) return;
  
  let currentIndex = 0;
  const animationSpeed = {{ section.settings.animation_speed | default: 4 }} * 1000; // Convert to milliseconds
  
  function showNextPartner() {
    // Hide current partner
    partnerNames[currentIndex].classList.remove('partners-autoscroll__partner-name--active');
    
    // Move to next partner
    currentIndex = (currentIndex + 1) % partnerNames.length;
    
    // Show next partner after a short delay
    setTimeout(() => {
      partnerNames[currentIndex].classList.add('partners-autoscroll__partner-name--active');
    }, 200);
  }
  
  // Start the animation cycle
  if (partnerNames.length > 1) {
    setInterval(showNextPartner, animationSpeed);
  }
});
</script>