{% schema %}
{
  "name": "Dynamic Features Grid",
  "tag": "section",
  "class": "features-grid-section",
  "settings": [
    {
      "type": "text",
      "id": "custom_anchor_id",
      "label": "Custom Section ID (for Smooth Scroll)",
      "default": "features-grid"
    },
    {
      "type": "checkbox",
      "id": "show_top_border",
      "label": "Show Top Border",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_bottom_border",
      "label": "Show Bottom Border",
      "default": true
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#FDFCF9",
      "info": "Leave as-is to mimic --custom-light."
    },

    /* Banner image (side) */
    {
      "type": "image_picker",
      "id": "section_image",
      "label": "Main Side Image"
    },
    {
      "type": "select",
      "id": "image_position",
      "label": "Image Position",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "image_fit",
      "label": "Banner Image Fit",
      "options": [
        { "value": "cover", "label": "Cover (fill & crop)" },
        { "value": "contain", "label": "Contain (no crop)" }
      ],
      "default": "cover"
    },

    /* Content */
    {
      "type": "text",
      "id": "overline",
      "label": "Sub text (above heading)",
      "default": "Premium Quality"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading (use <span> for accent)",
      "default": "Protecting your <span>little one</span>"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Crafting a high-quality training pants begins with the materials we select when making our products. We go to great lengths to ensure our products are gentle on your little one's skin.</p>"
    },

    {
      "type": "color",
      "id": "default_dot_color",
      "label": "Default Dot Color",
      "default": "#D4A574",
      "info": "Color for feature dots"
    },

    /* Spacing */
    {
      "type": "number",
      "id": "padding_top",
      "label": "Padding Top (px)",
      "default": 60
    },
    {
      "type": "number",
      "id": "padding_bottom",
      "label": "Padding Bottom (px)",
      "default": 60
    }
  ],
  "presets": [
    {
      "name": "Dynamic Features Grid",
      "category": "Custom"
    }
  ]
}
{% endschema %}

{% assign top_border_style = '' %}
{% if section.settings.show_top_border %}
  {% assign top_border_style = 'border-top: 1px solid var(--custom-dark)' %}
{% endif %}

{% assign bottom_border_style = '' %}
{% if section.settings.show_bottom_border %}
  {% assign bottom_border_style = 'border-bottom: 1px solid var(--custom-dark)' %}
{% endif %}

<div
  {% if section.settings.custom_anchor_id %}
    id="{{ section.settings.custom_anchor_id | escape }}"
  {% endif %}
  class="features-grid-section{% if section.settings.image_position == 'right' %} features-grid-section--reverse{% endif %}"
  style="
    {{ top_border_style }}; {{ bottom_border_style }};
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    background-color: {{ section.settings.background_color }};
    --grid-img-fit: {{ section.settings.image_fit }};
  "
>
  <div class="grid__image-col">
    {% if section.settings.section_image != blank %}
      <img
        src="{{ section.settings.section_image | image_url: width: 1600 }}"
        alt="{{ section.settings.heading | strip_html }}"
        width="1600"
        height="auto"
        loading="lazy"
        class="grid__img"
      >
    {% endif %}
  </div>

  <div class="grid__text-col">
    <div class="grid__text-inner">
      {% if section.settings.overline != blank %}
        <div class="grid__overline">{{ section.settings.overline }}</div>
      {% endif %}

      <h2 class="h1 grid__heading font-cursive">
        {{ section.settings.heading }}
      </h2>

      {% if section.settings.description != blank %}
        <div class="grid__desc">{{ section.settings.description }}</div>
      {% endif %}

      <!-- Dynamic Features from Product Metaobjects -->
      {% comment %} Always use current product if available {% endcomment %}
    {% assign target_product = product.metafields.custom.diaper_sizes.value %}
      {% if target_product %}
        <div class="grid__features-wrapper">
          {% comment %} Look for diaper_sizes metafield {% endcomment %}
                {% for size in target_product %}
                <div class="grid__feature-item">
                <span class="grid__feature-dot" style="background-color: {{ section.settings.default_dot_color }};"></span>
                <span class="grid__feature-text">{{ size.value }}</span>
              </div>
                {% endfor %}
        </div>
      {% else %}
        {% comment %} No product available {% endcomment %}
        <div class="grid__features-wrapper">
          <div class="grid__feature-item">
            <span class="grid__feature-dot" style="background-color: {{ section.settings.default_dot_color }};"></span>
            <span class="grid__feature-text">No product found</span>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<style>
/* Base - exact same values as split-section */
.features-grid-section {
  width: 100vw;
  min-height: 500px;
  display: flex;
  flex-direction: row;
  justify-content: stretch;
  align-items: stretch;
  transition: padding 0.2s, background-color 0.2s;
  font-family: inherit; /* Dawn default */
}
.features-grid-section--reverse { flex-direction: row-reverse; }

.grid__image-col {
  flex: 1 1 50%;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  min-height: 350px;
  max-height: 800px;
  overflow: hidden;
}

/* Banner (side) image: responsive */
.grid__img {
  width: 100%;
  height: auto;
  object-fit: var(--grid-img-fit);
  object-position: left center;
  display: block;
  border-radius: 0;
}
.features-grid-section--reverse .grid__img { object-position: right center; }

.grid__text-col {
  flex: 1 1 50%;
  display: flex;
  align-items: center;
  justify-content: flex-start;
}
.grid__text-inner {
  width: 100%;
  max-width: 800px;
  margin: 0 0 0 7vw;
  padding: 4vw 3vw 4vw 0;
  box-sizing: border-box;
}
.features-grid-section--reverse .grid__text-inner {
  margin: 0 7vw 0 0;
  padding: 4vw 0 4vw 3vw;
}

/* Overline / sub text */
.grid__overline {
  color: var(--custom-dark);
  letter-spacing: 0.06em;
  text-transform: none;
  font-size: 0.9em; /* 90% */
  line-height: 1.2;
  margin-bottom: 0.6rem;
}

/* Heading */
.grid__heading {
  color: var(--custom-dark);
  margin-bottom: 1.1rem;
  margin-top: 1.1rem;
  line-height: 1.13;
  font-weight: 400; /* normal */
}

/* Description */
.grid__desc {
  color: var(--custom-dark);
  opacity: 0.93;
  margin-bottom: 1.4rem;
  line-height: 1.6;
}

/* Features Grid */
.grid__features-wrapper {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.2rem 2rem;
  margin-top: 2rem;
}

.grid__feature-item {
  display: flex;
  align-items: center;
  gap: 0.8rem;
}

.grid__feature-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  flex-shrink: 0;
}

.grid__feature-text {
  color: var(--custom-dark);
  font-size: 1em;
  line-height: 1.4;
  font-weight: 400;
}

/* Breakpoints: 990 / 749 / 479 */
@media (max-width: 990px) {
  .features-grid-section { flex-direction: column !important; }
  .grid__image-col,
  .grid__text-col { flex: 0 0 100%; min-height: 350px; }
  .grid__img { object-position: center; }
  .grid__text-inner {
    margin: 0;
    padding: 6vw 6vw;
    text-align: center;
    max-width: 880px;
  }
  .grid__features-wrapper {
    justify-items: center;
  }
}
@media (max-width: 749px) {
  .grid__text-inner { padding: 7vw 5rem; }
}
@media (max-width: 479px) {
  .grid__text-inner { padding: 7vw 3rem; }
}
</style>